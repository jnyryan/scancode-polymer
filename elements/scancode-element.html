<link rel="import" href="../bower_components/polymer/polymer.html">
<script type="text/javascript" src="../bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="../lib/jquery-barcode-2.0.3/jquery-barcode.min.js"></script>
<script type="text/javascript" src="../lib/qrcode.js"></script>

<polymer-element name="scan-code">

  <dom-module id="scan-code">
    <template>
      <p>I'm a DOM element. This is my local DOM!</p>[[type]]
      <div id='scancode'></div>
    </template>
  </dom-module>

  <script>
  Polymer({
    is: "scan-code",
    properties: {
      data: { type: String, observer: 'dataChanged'},
      type: { type: String, observer: 'typeChanged'},
      format: { type: String, observer: 'formatChanged'},
      height: { type: String, observer: 'heightChanged'},
      width: { type: String, observer: 'widthChanged'}
    },

    ready: function(){
      console.log("ready");
      console.log(this.format);
      this.generate();
    },

    dataChanged: function () {
        this.generate();
    },

    typeChanged: function () {
        this.generate();
    },

    formatChanged: function () {
        console.log("Not Implememnted");
    },

    heightChanged: function () {
        this.generate();
    },

    widthChanged: function () {
        this.generate();
    },

    generate : function(){
      console.dir(this.type);
      if (this.type === 'barcode') {
          this.generateBarcode();
      }
      else {
          this.generateQRcode()
      }
    },

    generateQRcode: function(){
      var el = this.$.scancode;
      el.innerHTML = "";
      var qrcode = new QRCode(el, {
          text: this.data,
          width: this.width,
          height: this.height,
          colorDark : "#000000",
          colorLight : "#ffffff",
          correctLevel : QRCode.CorrectLevel.H
      });
    },

    generateBarcode: function(){
      var el = this.$.scancode;
      $(el).barcode(
        {code: this.data, crc:false},
        this.format,
        {barWidth:this.width, barHeight:this.height});
    }

  });
  </script>
</polymer-element>
